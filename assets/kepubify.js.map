{"version":3,"file":"kepubify.js","sources":["../node_modules/tslib/tslib.es6.js","../src/kepubify/wasm.ts","../src/kepubify/kepubify.ts"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n","/** @internal */\nexport const KepubifyWasmURL = new URL(\"./wasm/kepubify.wasm\", import.meta.url).toString()\n\n/** @internal */\nexport interface KepubifyWasmInit {\n    epub: ArrayBuffer,\n    config: KepubifyWasmOption[],\n    progress: boolean,\n}\n\n/** @internal */\nexport type KepubifyWasmOption = (\n    { type: \"Smartypants\" } |\n    { type: \"FindReplace\", find: string, replace: string } |\n    { type: \"DummyTitlepage\", add: boolean } |\n    { type: \"AddCSS\", css: string } |\n    { type: \"Hyphenate\", hyphenate: boolean } |\n    { type: \"FullScreenFixes\" }\n)\n\n/** @internal */\nexport type KepubifyWasmMessage = (\n    /** initialization */\n    { type: \"version\", version: string } |\n\n    /** conversion */\n    { type: \"progress\", n: number, total: number } |\n    { type: \"success\", kepub: ArrayBuffer } |\n    { type: \"error\", message: string } |\n\n    /** exit */\n    { type: \"panic\", message: string, stack: string } |\n    { type: \"exit\" }\n)\n","import { KepubifyWasmInit, KepubifyWasmMessage, KepubifyWasmOption, KepubifyWasmURL } from \"./wasm\"\nimport KepubifyWorkerImpl from \"web-worker:./worker\"\n\ntype QueueTask = {\n    epub: Blob,\n    config: KepubifyWasmOption[],\n    progress?: (n: number, total: number) => void,\n    resolve: (kepub: Blob) => void,\n    reject: (err?: any) => void,\n}\n\nexport class Kepubify {\n    #wasm?: WebAssembly.Module\n    #activeWorkers = new Set() // to work around bugs with workers being GC'd early\n\n    constructor() {\n        // set some sane defaults for the queue\n        if (isChrome() || isFirefox94()) {\n            // chrome and firefox 94+ has better memory management and performance for workers\n            this.#queueLimitWorkers = Math.max(Math.min(Math.ceil(navigator.hardwareConcurrency / (isChrome() ? 1 : 2)) || 2, 1), isMobile() ? 2 : 8)\n            this.#queueLimitFileSize = Math.max(Math.min(((navigator as any).deviceMemory || 2 as number)*1_000_000_000 / 2, 4_000_000_000) / this.#queueLimitWorkers, 50_000_000) / 2\n            this.#queueLimitFileSizeHard = 300_000_000\n        } else {\n            this.#queueLimitWorkers = 2\n            this.#queueLimitFileSize = 50_000_000\n            this.#queueLimitFileSizeHard = 250_000_000\n        }\n        console.log(`[kepubify] automatically configured worker limits: workers=${this.#queueLimitWorkers} fileSize=${formatBytes(this.#queueLimitFileSize)} fileSizeHard=${formatBytes(this.#queueLimitFileSizeHard)}`)\n    }\n\n    async init(progress?: (lengthComputable: boolean, loaded: number, total: number) => void): Promise<string> {\n        if (this.#wasm) {\n            throw new Error(\"kepubify already loaded\")\n        }\n        const buf = await get(KepubifyWasmURL, progress)\n        const wasm = await WebAssembly.compile(buf)\n        const version = await new KepubifyWorker(wasm).version\n        this.#wasm = wasm\n        return version\n    }\n\n    async kepubify(epub: Blob, config?: KepubifyConfig, progress?: (n: number, total: number) => void): Promise<Blob> {\n        if (!this.#wasm) {\n            throw new Error(\"kepubify not loaded\")\n        }\n        return new Promise((resolve, reject) => {\n            this.#queue.push({\n                epub,\n                config: config?.options ?? [],\n                progress,\n                resolve, reject,\n            })\n            this.#queueTryWork()\n        })\n    }\n\n    #queue: QueueTask[] = []\n    #queueCurrentFileSize: number = 0\n    #queueCurrentWorkers: number = 0\n\n    #queueStrictOrder: boolean = false\n    #queueLimitFileSize: number\n    #queueLimitFileSizeHard: number\n    #queueLimitWorkers: number\n\n    /** The maximum total file size which can be processed at a time. */\n    get queueLimitFileSize(): number {\n        return this.#queueLimitFileSize\n    }\n    set queueLimitFileSize(v: number) {\n        this.#queueLimitFileSize = v\n        this.#queueTryWork()\n    }\n\n    /** The maximum total file size which can be processed. */\n    get queueLimitFileSizeHard(): number {\n        return this.#queueLimitFileSizeHard\n    }\n    set queueMaximumFileSizeHard(v: number) {\n        this.#queueLimitFileSizeHard = v\n        this.#queueTryWork()\n    }\n\n    /** The maximum number of items which can be processed at once. */\n    get queueLimitWorkers(): number {\n        return this.#queueLimitWorkers\n    }\n    set queueLimitWorkers(v: number) {\n        this.#queueLimitWorkers = v\n        this.#queueTryWork()\n    }\n\n    /** Whether to try other queue items if the first would exceed the limit. */\n    get queueStrictOrder(): boolean {\n        return this.#queueStrictOrder\n    }\n    set queueStrictOrder(v: boolean) {\n        this.#queueStrictOrder = v\n        this.#queueTryWork()\n    }\n\n    #queueTryWork() {\n        // note: this is not racy since JS is single-threaded, and we don't have\n        // any async/awaits in here\n        while (this.#queue.length) {\n            if (this.#queueLimitWorkers && this.#queueCurrentWorkers >= this.#queueLimitWorkers) {\n                break\n            }\n            let firstMatch = 0\n            for (let i = 0; i < this.#queue.length; i++) {\n                // filter out items exceeding the hard limit\n                if (this.#queueLimitFileSizeHard && this.#queue[i].epub.size > this.#queueLimitFileSizeHard) {\n                    this.#queue[i].reject(new Error(`File too large for web version (maximum: ${formatBytes(this.#queueLimitFileSizeHard)})`))\n                    this.#queue.splice(i--, 1)\n                    continue\n                }\n                // filter out files exceeding the soft limit if there are active workers\n                if (this.#queueLimitFileSize && this.#queueCurrentFileSize) {\n                    if (this.#queueCurrentFileSize + this.#queue[i].epub.size > this.#queueLimitFileSize) {\n                        if (this.#queueStrictOrder) {\n                            firstMatch = -2\n                            break\n                        } else {\n                            continue\n                        }\n                    }\n                }\n                // if it wasn't filtered out, use it\n                firstMatch = i\n                break\n            }\n            if (firstMatch == -2) {\n                break\n            }\n            this.#queueDoWork(firstMatch)\n        }\n    }\n\n    #queueDoWork(i: number): Promise<void> {\n        const { epub, config, progress, resolve, reject } = this.#queue[i]\n        this.#queue.splice(i, 1)\n\n        this.#queueCurrentWorkers++\n        this.#queueCurrentFileSize += epub.size\n\n        return (async () => {\n            let worker\n            try {\n                const buf = await readAsArrayBuffer(epub)\n                this.#activeWorkers.add(worker = new KepubifyWorker(this.#wasm!, {\n                    epub: buf,\n                    config,\n                    progress: !!progress,\n                }, progress))\n                const kepub = await worker.kepub\n                resolve(new Blob([kepub], { type: \"application/epub+zip\" }))\n            } catch (ex) {\n                reject(ex)\n            } finally {\n                if (worker) {\n                    this.#activeWorkers.delete(worker)\n                }\n            }\n\n            this.#queueCurrentFileSize -= epub.size\n            this.#queueCurrentWorkers--\n            this.#queueTryWork()\n        })()\n    }\n}\n\n/** @internal */\nexport class KepubifyWorker {\n    #worker?: Worker\n\n    #kepub: Promise<ArrayBuffer>\n    #resolve?: (kepub: ArrayBuffer) => void\n    #reject?: (err: Error) => void\n\n    #version: Promise<string>\n    #resolveV?: (version: string) => void\n    #rejectV?: (err: Error) => void\n\n    #progress?: (n: number, total: number) => void\n\n    #timeout?: any\n\n    constructor(wasm: WebAssembly.Module, init?: KepubifyWasmInit, progress?: (n: number, total: number) => void) {\n        this.#kepub = new Promise((resolve, reject) => {\n            this.#resolve = x => {\n                resolve(x)\n                this.#resolve = undefined\n            }\n            this.#reject = x => {\n                reject(x)\n                this.#reject = undefined\n            }\n        })\n\n        // exit after resolve/reject\n        this.#kepub.then(\n            () => {\n                if (this.#worker) {\n                    this.#worker.onerror = null\n                    this.#worker.onmessage = null\n                }\n                window.setTimeout(() => this.terminate(), 100)\n            },\n            () => {\n                if (this.#worker) {\n                    this.#worker.onerror = null\n                    this.#worker.onmessage = null\n                }\n                window.setTimeout(() => this.terminate(), 100)\n            },\n        )\n\n        // version promise\n        this.#version = new Promise((resolve, reject) => {\n            this.#resolveV = x => {\n                resolve(x)\n                this.#resolveV = undefined\n            }\n            this.#rejectV = x => {\n                reject(x)\n                this.#rejectV = undefined\n            }\n        })\n\n        // initialization timeout (for returning the version)\n        this.#timeout = setTimeout(() => {\n            const err = new Error(\"worker did not start in time\")\n            this.#rejectV?.(err)\n            this.#reject?.(err)\n        }, 2000)\n\n        // conversion progress\n        this.#progress = progress\n\n        // start the worker\n        this.#worker = new KepubifyWorkerImpl()\n        this.#worker!.onmessage = this.#message.bind(this)\n        this.#worker!.onerror = this.#error.bind(this)\n        this.#worker!.postMessage({ wasm, init: init })\n    }\n\n    terminate() {\n        const err = new Error(\"worker terminated\")\n        this.#rejectV?.(err)\n        this.#reject?.(err)\n        this.#worker?.terminate()\n        this.#worker = undefined\n    }\n\n    /** Gets the promise which resolves with the version after worker init. */\n    get version(): Promise<string> {\n        return this.#version\n    }\n\n    /** Gets the promise which resolves with the kepub. */\n    get kepub(): Promise<ArrayBuffer> {\n        return this.#kepub\n    }\n\n    /** Handles uncaught errors, which should only occur during init. */\n    #error(ev: ErrorEvent) {\n        const err = ev.error instanceof Error\n            ? ev.error\n            : new Error(`${ev.message} (at ${ev.filename}:${ev.lineno}:${ev.colno})`)\n        this.#rejectV?.(err)\n        this.#reject?.(err)\n    }\n\n    /** Handles messages from the Go module. */\n    #message(ev: MessageEvent) {\n        let err\n        const data = ev.data as KepubifyWasmMessage\n        switch (data.type) {\n            /** initialization */\n            case \"version\":\n                clearTimeout(this.#timeout)\n                this.#resolveV?.(data.version)\n                break\n\n            /** conversion */\n            case \"progress\":\n                this.#progress?.(data.n, data.total)\n                break\n            case \"success\":\n                this.#resolve?.(data.kepub)\n                break\n            case \"error\":\n                err = new KepubifyError(data.message)\n                this.#reject?.(err)\n                break\n\n            /** exit */\n            case \"panic\":\n                err = new Error(`worker panicked: ${data.message}`)\n                err.stack = data.message + \"\\n\\n\" + data.stack\n                this.#rejectV?.(err)\n                this.#reject?.(err)\n                break\n            case \"exit\":\n                err = new Error(\"worker exited prematurely\")\n                this.#rejectV?.(err)\n                this.#reject?.(err)\n                break\n        }\n    }\n}\n\nexport class KepubifyConfig {\n    #options: KepubifyWasmOption[] = []\n\n    /** @internal */\n    get options(): KepubifyWasmOption[] {\n        return this.#options\n    }\n\n    smartypants(): this {\n        this.#options.push({ type: \"Smartypants\" })\n        return this\n    }\n\n    findReplace(find: string, replace: string): this {\n        this.#options.push({ type: \"FindReplace\", find, replace })\n        return this\n    }\n\n    dummyTitlepage(add: boolean): this {\n        this.#options.push({ type: \"DummyTitlepage\", add })\n        return this\n    }\n\n    addCSS(css: string): this {\n        this.#options.push({ type: \"AddCSS\", css })\n        return this\n    }\n\n    hyphenate(hyphenate: boolean): this {\n        this.#options.push({ type: \"Hyphenate\", hyphenate })\n        return this\n    }\n\n    fullScreenFixes(): this {\n        this.#options.push({ type: \"FullScreenFixes\" })\n        return this\n    }\n}\n\nexport class KepubifyError extends Error {\n    constructor(message?: string) {\n        super(message)\n        this.name = KepubifyError.name\n    }\n}\n\nasync function readAsArrayBuffer(blob: Blob, progress?: (lengthComputable: boolean, loaded: number, total: number) => void): Promise<ArrayBuffer> {\n    return new Promise((resolve, reject) => {\n        const rd = new FileReader()\n        rd.addEventListener(\"abort\", ev => {\n            progress?.(ev.lengthComputable, ev.loaded, ev.total)\n            reject(new Error(\"aborted\"))\n        })\n        rd.addEventListener(\"error\", ev => {\n            progress?.(ev.lengthComputable, ev.loaded, ev.total)\n            reject(rd.error)\n        })\n        rd.addEventListener(\"loadstart\", ev => {\n            progress?.(ev.lengthComputable, ev.loaded, ev.total)\n        })\n        rd.addEventListener(\"progress\", ev => {\n            progress?.(ev.lengthComputable, ev.loaded, ev.total)\n        })\n        rd.addEventListener(\"load\", () => {\n            resolve(rd.result as ArrayBuffer)\n        })\n        rd.readAsArrayBuffer(blob)\n    })\n}\n\nfunction get(url: string, progress?: (lengthComputable: boolean, loaded: number, total: number) => void): Promise<ArrayBuffer> {\n    return new Promise((resolve, reject) => {\n        const req = new XMLHttpRequest()\n        req.addEventListener(\"abort\", ev => {\n            progress?.(ev.lengthComputable, ev.loaded, ev.total)\n            reject(new Error(\"request aborted\"))\n        })\n        req.addEventListener(\"error\", ev => {\n            progress?.(ev.lengthComputable, ev.loaded, ev.total)\n            reject(new Error(\"network error\"))\n        })\n        req.addEventListener(\"timeout\", ev => {\n            progress?.(ev.lengthComputable, ev.loaded, ev.total)\n            reject(new Error(\"request timed out\"))\n        })\n        req.addEventListener(\"load\", ev => {\n            progress?.(ev.lengthComputable, ev.loaded, ev.total)\n            if (req.status != 200) {\n                reject(new Error(`status ${req.status} ${req.statusText}`))\n            } else {\n                resolve(req.response)\n            }\n        })\n        req.addEventListener(\"loadstart\", ev => {\n            progress?.(ev.lengthComputable, ev.loaded, ev.total)\n        })\n        req.addEventListener(\"progress\", ev => {\n            progress?.(ev.lengthComputable, ev.loaded, ev.total)\n        })\n        req.responseType = \"arraybuffer\"\n        req.open(\"GET\", url)\n        req.send()\n    })\n}\n\nfunction formatBytes(bytes: number): string {\n    if (bytes > 1000000) {\n        return `${Math.round(bytes/1000000)} MB`\n    } else if (bytes > 1000) {\n        return `${Math.round(bytes/1000)} KB`\n    } else {\n        return `${Math.round(bytes)} bytes`\n    }\n}\n\nfunction isChrome(): boolean {\n    return !!(window as any).chrome\n}\n\nfunction isFirefox94(): boolean {\n    const m = navigator.userAgent.match(/\\sFirefox\\/([0-9]+)\\./)\n    return m?.length == 2 && parseInt(m[1], 10) >= 94\n}\n\nfunction isMobile(): boolean {\n    return /Mobi/i.test(window.navigator.userAgent)\n}\n"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","adopt","then","apply","__classPrivateFieldGet","receiver","state","kind","f","TypeError","has","call","get","__classPrivateFieldSet","set","KepubifyWasmURL","URL","document","location","require","__dirname","href","currentScript","src","baseURI","__filename","toString","this","_Kepubify_queue","length","_Kepubify_queueLimitWorkers","_Kepubify_queueCurrentWorkers","firstMatch","i","_Kepubify_queueLimitFileSizeHard","epub","size","Error","formatBytes","splice","_Kepubify_queueLimitFileSize","_Kepubify_queueCurrentFileSize","_Kepubify_queueStrictOrder","_Kepubify_instances","_Kepubify_queueDoWork","config","progress","_a","worker","buf","readAsArrayBuffer","blob","rd","FileReader","addEventListener","ev","lengthComputable","loaded","total","error","_Kepubify_activeWorkers","add","KepubifyWorker","kepub","Blob","type","ex","delete","_b","_Kepubify_queueTryWork","[object Object]","wasm","init","_KepubifyWorker_worker","_KepubifyWorker_kepub","_KepubifyWorker_resolve","_KepubifyWorker_reject","_KepubifyWorker_version","_KepubifyWorker_resolveV","_KepubifyWorker_rejectV","_KepubifyWorker_progress","_KepubifyWorker_timeout","x","undefined","onerror","onmessage","window","setTimeout","terminate","err","KepubifyWorkerImpl","_KepubifyWorker_instances","_KepubifyWorker_message","bind","_KepubifyWorker_error","postMessage","_c","version","message","filename","lineno","colno","data","clearTimeout","n","KepubifyError","_d","stack","_e","_f","_g","_h","super","name","bytes","Math","round","isChrome","chrome","Kepubify","_Kepubify_wasm","Set","isFirefox94","m","navigator","userAgent","match","parseInt","max","min","ceil","hardwareConcurrency","isMobile","test","deviceMemory","console","log","url","req","XMLHttpRequest","status","statusText","response","responseType","open","send","WebAssembly","compile","push","options","queueLimitFileSize","v","queueLimitFileSizeHard","queueMaximumFileSizeHard","queueLimitWorkers","queueStrictOrder","KepubifyConfig","_KepubifyConfig_options","find","replace","css","hyphenate"],"mappings":"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"}